<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <title>心脉科技</title>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but sph5 doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <!-- built files will be auto injected -->
    <script src="./font/iconfont.js"></script>
  <!-- <script src="./js/jweixin-1.4.0.js"></script> -->
  <script>

      var AppId = 'wx9bd9279a9b4ee6a9';
      // 微信授权实际是页面跳转，跳转过程中会存在code，获取code成功向后台发起请求获取openId和微信认证的签名和对应的生成签名的时间戳和随机字符串（非静默授权方可拿到用户信息，以下以非静默授权为例）
      //获取url中的code值 和当前的url（#之前，具体参数详见技术文档js-SDK使用说明）
      var code = getUrlParam('code');
      var local = window.location.href;

      function getUrlParam (name) {
          var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)');
          var r = window.location.search.substr(1).match(reg);
          if (r != null) return decodeURIComponent(r[2]); return null;
      }

      function authWechat(){
          // if(code == null || code == ''){
          //     //拿不到code，刷新页面继续
          //     window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid='+AppId+'&redirect_uri='+encodeURIComponent(local)+'&response_type=code&scope=snsapi_userinfo&state=1&wechat_redirect';
          // }
      }
      authWechat()
      // function getCrtUrl(){
      //     var temp = window.location.href;
      //     var end = temp.indexOf('#');
      //     if(end!=-1){
      //         return temp.substring(0,end);
      //     }else{
      //         return temp
      //     }
      // }
      // 认证
      // function wxConfig(){
      //     wx.config({
      //         debug: true,// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
      //         appId: AppId, // 必填，公众号的唯一标识
      //         timestamp: Timestamp, // 必填，生成签名的时间戳
      //         nonceStr: NonceStr, // 必填，生成签名的随机串
      //         signature: Signature,// 必填，签名
      //         jsApiList: ['openLocation','getLocation','closeWindow','checkJsApi'] //
      //     });
      //
      //     var latitude;
      //     var longitude;
      //     var speed;
      //     var accuracy;
      //     wx.ready(function(){
      //         wx.checkJsApi({
      //             jsApiList: ['getLocation'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
      //             success: function(res) {
      //                 alert('dsgsdag' + res.checkResult.getLocation);
      //                 if (res.checkResult.getLocation == false) {
      //                     alert("你的微信版本太低，不支持微信JS接口，请升级到最新的微信版本！");
      //                     return;
      //                 }
      //             }
      //         });
      //         // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。
      //         // 以认证成功进行定位为例说明；
      //         try {
      //             wx.getLocation({
      //                 success : function(res) {
      //                     alert('getLoc success');
      //                     latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
      //                     longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
      //                     /* speed = res.speed; // 速度，以米/每秒计     */
      //                     accuracy = res.accuracy; // 位置精度
      //                     baiduGeo(latitude,longitude);
      //                 },
      //                 fail : function(res) {
      //                     alert('wx.getL fail');
      //                     _self.$dialog.alert({
      //                         message: '定位失效，请手动选择'
      //                     }).then(function(){
      //                         _self.$router.push('location');
      //                     })
      //                 },
      //                 cancel: function (res) {
      //                     alert('getLoc cancel');
      //                     wx.closeWindow();
      //                 },
      //                 complete:function(res){
      //                     alert('complete');
      //                 }
      //             });
      //         }
      //         catch(e) {
      //             alert(e);
      //         }
      //     });
      //     wx.error(function(res){
      //         // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
      //         _self.$dialog.alert({
      //             message: '微信认证失败，请重试'
      //         }).then(function(){
      //             wx.closeWindow();
      //         })
      //     });
      //     function baiduGeo(latitude,longitude){
      //         //baidu
      //         var latlon = latitude +','+longitude;
      //         var urlBaidu = "http://api.map.baidu.com/geocoder/v2/?ak=C93b5178d7a8ebdb830b9b557abce78b&callback=renderReverse&location="+latlon+"&output=json&pois=0";
      //         _self.$http.jsonp(urlBaidu).then(function(res){
      //             var res = JSON.parse(res.bodyText);
      //             var locIso = res.result.addressComponent.country_code_iso;
      //             _self.position_loc = res.result.addressComponent.country;
      //             if(_self.position_loc !='Mali'){
      //                 _self.$dialog.confirm({
      //                     message: '根据定位,您所在的区域尚未开放服务,是否手动选择区域'
      //                 }).then(function(){
      //                     localStorage.setItem('position_loc',res.result.addressComponent.country_code_iso);
      //                     _self.$router.push('location');
      //                 },function(){
      //                     wx.closeWindow();
      //                 }).catch(function(){
      //                 });
      //             }else{
      //                 localStorage.setItem('position_loc',_self.Kit.getCountryMcc(locIso));
      //                 _self.$router.push('home');
      //             }
      //         },function(res){
      //             _self.$dialog.alert({
      //                 message: '定位系统失效，请手动选择'
      //             }).then(function(){
      //                 _self.$router.push('location');
      //             })
      //         })
      //     }
      // }
  </script>
  </body>
</html>
